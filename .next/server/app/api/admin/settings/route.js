"use strict";(()=>{var e={};e.id=9080,e.ids=[9080],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},32001:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>c,PUT:()=>l});var s=r(49303),a=r(88716),i=r(60670),o=r(87070),u=r(83493),d=r(90455);async function c(){try{let e=await u.Z.systemSettings.findUnique({where:{id:"main"}});return e||(e=await u.Z.systemSettings.create({data:{id:"main"}})),o.NextResponse.json({settings:e})}catch(e){return console.error("Error fetching settings:",e),o.NextResponse.json({error:e.message},{status:500})}}async function l(e){try{try{await (0,d.mk)(e,["ADMIN"])}catch(e){return o.NextResponse.json({error:"Unauthorized"},{status:401})}let t=await e.json();delete t.id,delete t.createdAt,delete t.updatedAt;let r=await u.Z.systemSettings.upsert({where:{id:"main"},update:t,create:{id:"main",...t}});return o.NextResponse.json({settings:r,message:"Settings updated successfully"})}catch(e){return console.error("Error updating settings:",e),o.NextResponse.json({error:e.message},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/settings/route",pathname:"/api/admin/settings",filename:"route",bundlePath:"app/api/admin/settings/route"},resolvedPagePath:"C:\\Users\\DENUEL\\Documents\\denuel app rental\\app\\api\\admin\\settings\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:m}=p,g="/api/admin/settings/route";function w(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},90455:(e,t,r)=>{r.d(t,{$v:()=>g,Gv:()=>m,LY:()=>k,PR:()=>w,cL:()=>S,c_:()=>f,mk:()=>x,requireCsrf:()=>R,si:()=>y});var n=r(41482),s=r.n(n),a=r(42023),i=r.n(a),o=r(83493),u=r(84770),d=r.n(u);let c=process.env.JWT_SECRET||"changeme",l=process.env.REFRESH_TOKEN_SECRET||process.env.JWT_SECRET||"changeme",p="denuel_csrf";function h(e){return d().createHash("sha256").update(e).digest("hex")}function f(e){let t=i().genSaltSync(10);return i().hashSync(e,t)}function m(e,t){return i().compareSync(e,t)}function g(e){try{return s().verify(e,c)}catch(e){return null}}async function w(e){try{let t=(e.headers.get("cookie")||"").match(/denuel_token=([^;]+)/);if(!t)return null;let r=t[1],n=g(r);if(!n)return null;let s=await o.Z.user.findUnique({where:{id:n.id}});if(!s)return null;return delete s.password,s}catch(e){return null}}async function x(e,t=[]){let r=(e.headers.get("cookie")||"").match(/denuel_token=([^;]+)/);if(!r)throw new Response("Unauthorized",{status:401});let n=g(r[1]);if(!n)throw new Response("Unauthorized",{status:401});let s=await o.Z.user.findUnique({where:{id:n.id}});if(!s)throw new Response("Unauthorized",{status:401});if(t.length&&!t.includes(s.role))throw new Response("Forbidden",{status:403});return delete s.password,s}async function S(e,t){let r=function(e,t="7d"){return s().sign(e,c,{expiresIn:t})}({id:t.id,role:t.role},"7d"),n=d().randomUUID(),a=s().sign({id:t.id,jti:n},l,{expiresIn:"30d"}),i=h(a),u=new Date(Date.now()+2592e6);await o.Z.refreshToken.create({data:{userId:t.id,tokenHash:i,jti:n,expiresAt:u}}),e.headers.append("Set-Cookie",`denuel_token=${r}; HttpOnly; Path=/; Max-Age=604800; SameSite=Lax; Secure=true`),e.headers.append("Set-Cookie",`denuel_refresh=${a}; HttpOnly; Path=/; Max-Age=2592000; SameSite=Lax; Secure=true`);let f=d().randomBytes(24).toString("hex");return e.headers.append("Set-Cookie",`${p}=${f}; Path=/; Max-Age=86400; SameSite=Lax; Secure=true`),e}async function y(e){if(!e)return null;try{let t=s().verify(e,l),r=t.jti,n=await o.Z.refreshToken.findUnique({where:{jti:r}});if(!n||n.isRevoked||n.expiresAt<new Date||h(e)!==n.tokenHash)return null;let a=await o.Z.user.findUnique({where:{id:t.id}});if(!a)return null;return delete a.password,{user:a,jti:r}}catch(e){return null}}function R(e){let t=(e.headers.get("x-csrf-token")||"").toString(),r=(e.headers.get("cookie")||"").match(RegExp(`${p}=([^;]+)`));if(!r)throw new Response("Invalid CSRF token",{status:403});let n=r[1];if(!t||t!==n)throw new Response("Invalid CSRF token",{status:403});return!0}async function k(e){await o.Z.refreshToken.updateMany({where:{jti:e},data:{isRevoked:!0}})}},83493:(e,t,r)=>{r.d(t,{Z:()=>a,_:()=>s});let n=require("@prisma/client"),s=global.prisma||new n.PrismaClient,a=s}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,3652,1482,5972,2023],()=>r(32001));module.exports=n})();